<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Niki Lauda Taller{% endblock %}</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css">

    <style>
        :root {
            --rojo-ferrari: #D90429;
            --rojo-ferrari-oscuro: #A3001F;
            --negro-carbon: #0B0C10;
            --gris-metal: #1F2833;
            --amarillo-f1: #FFC300;
        }

        body {
            background-color: var(--negro-carbon);
            color: white;
            font-family: 'Poppins', sans-serif;
            overflow-x: hidden;
        }

        /* SIDEBAR */
        .sidebar {
            width: 250px;
            height: 100vh;
            background-color: var(--gris-metal);
            position: fixed;
            top: 0;
            left: 0;
            border-right: 3px solid var(--rojo-ferrari);
            padding-top: 20px;
            z-index: 1000;
        }

        .sidebar .brand {
            text-align: center;
            margin-bottom: 30px;
        }

        .sidebar .brand img {
            max-width: 180px;
            filter: drop-shadow(0 0 3px black);
        }

        .sidebar a {
            display: block;
            padding: 12px 25px;
            color: #FFF;
            text-decoration: none;
            font-size: 1.1rem;
            border-left: 3px solid transparent;
            transition: 0.2s;
        }

        .sidebar a:hover {
            background-color: #11141A;
            border-left: 3px solid var(--amarillo-f1);
            color: var(--amarillo-f1);
        }

        /* CONTENIDO */
        .content {
            margin-left: 250px;
            padding: 40px;
        }

        .card {
            background-color: var(--gris-metal);
            border-left: 4px solid var(--rojo-ferrari);
        }

        .btn-primary {
            background-color: var(--rojo-ferrari);
            border: none;
        }

        .btn-primary:hover {
            background-color: var(--rojo-ferrari-oscuro);
        }

        /* ====== FIX VISIBILIDAD DEL TEXTO ====== */

        /* Texto normal */
        body, p, span, li, td {
            color: #EAEAEA !important;  /* Gris claro elegante */
        }

        /* Subtítulos o textos secundarios */
        .text-muted, small {
            color: #BFC7D5 !important; /* Gris medio visible */
        }

        /* Encabezados */
        h1, h2, h3, h4, h5, h6 {
            color: #FFFFFF !important; /* Blanco puro */
        }

        /* Títulos estilo F1 */
        .f1-title {
            color: var(--amarillo-f1) !important;
            text-shadow: 0 0 3px #000;
        }

        /* Enlaces */
        a {
            color: #4DA8FF !important; /* Azul brillante racing */
            text-decoration: none;
        }

        a:hover {
            color: #82C6FF !important;
        }


                /* Mejorar legibilidad en formularios */
        label, .form-label, .form-control-label {
            color: #FFFFFF !important;   /* Blanco puro */
            font-weight: 600;
        }

        /* Placeholder más visible en fondos oscuros */
        ::placeholder {
            color: #CCCCCC !important;
            opacity: 1;
        }


    </style>

    {% block extra_css %}{% endblock %}
</head>



<script>
/* ===========================================================
   SISTEMA COMPLETO DE INACTIVIDAD — F1 EDITION
   =========================================================== */

let timerInactividad;      // Timer general
let timerAdvertencia;      // Timer para mostrar popup
let cuentaRegresiva;       // Intervalo para countdown
const LIMITE_MINUTOS = 10;     // Tiempo total
const AVISO_SEGUNDOS = 30;     // Aviso antes del cierre
const LIMITE_MS = LIMITE_MINUTOS * 60 * 1000;
const AVISO_MS = LIMITE_MS - (AVISO_SEGUNDOS * 1000);

const modal = document.getElementById("modalInactividad");
const contador = document.getElementById("contadorInactividad");
const btnSeguir = document.getElementById("btnSeguirActivo");


/* -----------------------------------------------------------
   Reiniciar temporizadores
----------------------------------------------------------- */
function reiniciarTimers() {
    // Ocultar modal si estaba visible
    modal.style.display = "none";

    // Eliminar timers anteriores
    clearTimeout(timerInactividad);
    clearTimeout(timerAdvertencia);
    clearInterval(cuentaRegresiva);

    // Timer de advertencia (mostrar popup)
    timerAdvertencia = setTimeout(() => {
        mostrarAdvertencia();
    }, AVISO_MS);

    // Timer final — cerrar sesión
    timerInactividad = setTimeout(() => {
        window.location.href = "/logout/";
    }, LIMITE_MS);
}


/* -----------------------------------------------------------
   Mostrar popup con cuenta regresiva
----------------------------------------------------------- */
function mostrarAdvertencia() {
    modal.style.display = "flex";
    let tiempo = AVISO_SEGUNDOS;

    contador.textContent = tiempo;

    cuentaRegresiva = setInterval(() => {
        tiempo--;
        contador.textContent = tiempo;

        if (tiempo <= 0) {
            clearInterval(cuentaRegresiva);
        }
    }, 1000);
}


/* -----------------------------------------------------------
   Eventos que reinician actividad
----------------------------------------------------------- */
const eventos = ["mousemove", "keydown", "scroll", "click", "touchstart", "touchmove"];
eventos.forEach(ev => {
    document.addEventListener(ev, reiniciarTimers);
});


/* -----------------------------------------------------------
   Botón del popup → reinicia la actividad
----------------------------------------------------------- */
btnSeguir.addEventListener("click", () => {
    reiniciarTimers();
});


/* -----------------------------------------------------------
   Iniciar sistema al cargar
----------------------------------------------------------- */
reiniciarTimers();
</script>

<body>

    <!-- SIDEBAR -->
    <div class="sidebar">

        <!-- LOGO -->
        <div class="brand">
            <img src="/static/img/logo_nikilauda.svg" alt="Niki Lauda Taller">
        </div>

        <a href="/"><i class="bi bi-house-fill me-2"></i> Inicio</a>

        <a href="{% url 'registrar_trabajo' %}">
            <i class="bi bi-clipboard-plus me-2"></i> Registrar Trabajo
        </a>

        <a href="{% url 'lista_trabajos' %}">
            <i class="bi bi-list-task me-2"></i> Ver Trabajos
        </a>

        {% if user.is_authenticated and user.perfil.rol == "ADMIN" %}
        <a href="{% url 'gestionar_usuarios' %}">
            <i class="bi bi-speedometer2 me-2"></i> Panel Admin
        </a>

        <a href="{% url 'gestionar_usuarios' %}">
            <i class="bi bi-people-fill me-2"></i> Usuarios
        </a>

        <a href="{% url 'crear_usuario' %}">
            <i class="bi bi-person-plus-fill me-2"></i> Crear Usuario
        </a>
        {% endif %}

        {% if user.is_authenticated %}
        <a href="{% url 'logout' %}">
            <i class="bi bi-box-arrow-right me-2"></i> Cerrar Sesión
        </a>
        {% else %}
        <a href="{% url 'login' %}">
            <i class="bi bi-box-arrow-in-right me-2"></i> Ingresar
        </a>
        {% endif %}
    </div>

    <!-- CONTENIDO PRINCIPAL -->
    <div class="content">
        {% block content %}{% endblock %}
    </div>

    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    {% block extra_js %}{% endblock %}


    <!-- =========================================== -->
    <!-- POPUP ALERTA DE INACTIVIDAD (MODAL F1)      -->
    <!-- =========================================== -->
    <div id="modalInactividad" 
        style="
            display:none;
            position:fixed;
            top:0; left:0; width:100%; height:100%;
            background:rgba(0,0,0,0.65);
            backdrop-filter:blur(4px);
            z-index:5000;
            justify-content:center;
            align-items:center;">
        
        <div style="
            background:#1F2833;
            border-left:5px solid var(--rojo-ferrari);
            padding:25px;
            border-radius:12px;
            width:350px;
            text-align:center;
            color:white;
            box-shadow:0 0 20px rgba(255,0,0,0.4);
            font-family:Poppins;">
            
            <h3 style="font-family:Orbitron; color:var(--amarillo-f1);">
                ⚠ Sesión por Expirar
            </h3>
            
            <p class="mt-3">
                Tu sesión se cerrará automáticamente en<br>
                <span id="contadorInactividad" 
                    style="font-size:2rem; color:#FF5959; font-weight:bold;">
                    30
                </span>
                segundos.
            </p>

            <button id="btnSeguirActivo" 
                    class="btn mt-3"
                    style="
                        width:100%;
                        background:var(--rojo-ferrari);
                        color:white;
                        font-weight:600;">
                Seguir Activo
            </button>
        </div>
    </div>

</body>
</html>


